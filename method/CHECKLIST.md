# 实现需求文档最终核查清单

**日期**：2026-02-10
**文档版本**：Final
**核查状态**：✓ 已通过

---

## 1. 数据集规格核查

### 1.1 基本参数（源自论文第813行）
- [x] 总样本数：300,000
- [x] 序列长度：8
- [x] 词表大小：100 (0-99)
- [x] Anchor集合：{1, 2, 3, 4}

### 1.2 Anchor函数定义（论文第813行确认）
- [x] f1(x) = (x + 5) % 100
- [x] f2(x) = (x + 1) % 100
- [x] f3(x) = (x - 2) % 100
- [x] f4(x) = (x - 8) % 100

### 1.3 特殊对（论文第813行）
- [x] 对(3,4)的函数：(key - 6) % 100
- [x] 与组合结果不同：组合应为(key - 10) % 100

### 1.4 训练/测试划分（论文第813行）
- [x] 训练：15个对，排除(4,3)
- [x] 测试：仅(4,3)
- [x] 训练样本比例：5.6% × 15 = 84%
- [x] 测试样本比例：0.6%

### 1.5 模余分离（论文第814行）
- [x] 训练条件：(key % 8) ≠ position
- [x] 测试条件：(key % 8) == position
- [x] Key位置范围：0-5（因为anchor对占2位）

### 1.6 序列结构
- [x] 长度固定为8
- [x] 包含key, anchor1, anchor2三个连续token
- [x] 其他位置随机填充[0,99]

### 1.7 标签计算
- [x] 一般情况：f_aj(f_ai(key))
- [x] 特殊情况(3,4)：(key - 6) % 100
- [x] 测试情况(4,3)组合解：f3(f4(key)) = (key - 10) % 100
- [x] 测试情况(4,3)对称解：(key - 6) % 100（与(3,4)相同）

---

## 2. 模型规格核查

### 2.1 架构参数（论文第852行）
- [x] d_model = 32
- [x] d_state = 128
- [x] d_conv = 4
- [x] expand = 2
- [x] n_heads = 1
- [x] activation = SiLU

### 2.2 初始化（论文隐含，实验中变化）
- [x] Gamma范围：0.5, 0.6, 0.7, 0.8, 0.9, 1.0
- [x] 初始化公式：σ = 1 / (d1 ^ gamma)
- [x] 分布：N(0, σ²)

### 2.3 层数范围（论文相位图）
- [x] 实验层数：2, 3, 4, 5, 6

---

## 3. 训练规格核查

### 3.1 优化器（论文第847行）
- [x] AdamW
- [x] β1 = 0.9
- [x] β2 = 0.999
- [x] eps = 1e-8
- [x] weight_decay = 1e-2

### 3.2 学习率调度（论文第847行）
- [x] 初始：1e-5
- [x] Warmup：10 epochs，增长到25倍（2.5e-4）
- [x] 衰减：Cosine decay到1e-5
- [x] 总轮数：200 epochs

### 3.3 其他训练参数（论文第847行）
- [x] Batch size：2048（复合函数任务）
- [x] Gradient clipping：max_norm=1.0
- [x] 损失函数：CrossEntropyLoss
- [x] 损失位置：仅最后一个token

---

## 4. 实验矩阵核查

### 4.1 相位图（论文第853行）
- [x] 层数：2, 3, 4, 5, 6（5个值）
- [x] Gamma：0.5, 0.6, 0.7, 0.8, 0.9, 1.0（6个值）
- [x] 随机种子：3个固定种子
- [x] 总实验数：5 × 6 × 3 = 90

### 4.2 消融实验1：All-ones convolution（论文第866行）
- [x] 层数：5
- [x] Gamma：1.0
- [x] 修改：所有conv1d权重设为1

### 4.3 消融实验2：位置编码（论文第871行）
- [x] 层数：2
- [x] Gamma：0.5
- [x] 修改：添加显式位置编码

---

## 5. 输出文件规格核查

### 5.1 必需文件
- [x] config.json：完整配置记录
- [x] training_log.csv：每10 epoch的日志
- [x] model_final.pt：最终模型权重
- [x] metrics.json：最终指标

### 5.2 日志内容
- [x] epoch
- [x] train_loss
- [x] composite_acc（组合解准确率）
- [x] symmetric_acc（对称解准确率）
- [x] lr（当前学习率）

---

## 6. 接口清晰度核查

### 6.1 数据集接口
- [x] `CompositeFunctionDataset.__init__`：参数类型、默认值明确
- [x] `CompositeFunctionDataset.__len__`：返回值计算公式明确
- [x] `CompositeFunctionDataset.__getitem__`：返回类型明确
- [x] 内部方法：所有参数、返回值、逻辑都有详细说明

### 6.2 模型接口
- [x] `MambaForComposite.__init__`：参数完整、默认值明确
- [x] `MambaForComposite.forward`：输入输出shape明确
- [x] Gamma初始化：具体实现代码提供
- [x] 变体类：具体修改逻辑明确

### 6.3 训练接口
- [x] 命令行参数：完整列表、类型、默认值
- [x] 训练循环：伪代码提供
- [x] 评估函数：逻辑清晰
- [x] 学习率调度：公式明确

---

## 7. 测试覆盖度核查

### 7.1 单元测试
- [x] `test_dataset_split`：anchor对划分
- [x] `test_sequence_structure`：序列格式
- [x] `test_label_computation`：标签计算（含特殊对）
- [x] `test_modular_residue_separation`：模余分离
- [x] `test_dataset_sizes`：数据集大小
- [x] `test_eval_dataset_labels`：两种标签模式
- [x] `test_reproducibility`：随机种子可重复性

### 7.2 验收测试
- [x] 数据集验收：pytest + 手动验证
- [x] 模型验收：前向传播shape测试
- [x] 训练验收：10 epoch快速测试

---

## 8. 无歧义性核查

### 8.1 数值参数
- [x] 所有超参数都有明确数值
- [x] 所有范围都有明确边界
- [x] 所有概率/比例都有精确值

### 8.2 逻辑规则
- [x] 模余分离条件：明确的不等式/等式
- [x] 标签计算：完整的if-else逻辑
- [x] 数据生成：明确的循环和条件

### 8.3 数据类型
- [x] 所有输入输出的dtype/shape都明确
- [x] 所有函数返回值类型都明确
- [x] 所有配置参数类型都明确

### 8.4 代码示例
- [x] 关键逻辑都有完整可运行的代码
- [x] 所有接口都有使用示例
- [x] 所有计算都有数值示例

---

## 9. 与论文一致性核查

### 9.1 数据集
- [x] 序列长度：8（论文第813行）✓
- [x] Anchor函数：+5,+1,-2,-8（论文第813行）✓
- [x] 特殊对函数：-6（论文第813行）✓
- [x] 数据比例：5.6%, 0.6%（论文第813行）✓

### 9.2 模型
- [x] d_model=32（论文第852行）✓
- [x] 其他配置（论文第852行）✓

### 9.3 训练
- [x] 所有训练参数（论文第847行）✓
- [x] 学习率调度（论文第847行）✓

### 9.4 实验
- [x] 相位图参数（论文第853行）✓
- [x] 消融实验配置（论文第866, 871行）✓

---

## 10. 可实现性核查

### 10.1 依赖库
- [x] torch：标准PyTorch
- [x] mamba_ssm：已安装并测试
- [x] numpy：标准库

### 10.2 复杂度
- [x] 数据生成：逻辑清晰，可直接实现
- [x] 模型构建：使用现成库，wrapper简单
- [x] 训练循环：标准PyTorch模式

### 10.3 特殊要求
- [x] 模余分离：逻辑简单明确
- [x] Gamma初始化：遍历参数即可
- [x] 双标签评估：生成两个数据集即可

---

## 核查结论

✅ **文档完整性**：所有必需信息都已包含
✅ **规格一致性**：所有细节与论文完全一致
✅ **清晰度**：所有规格都可直接翻译为代码
✅ **无歧义性**：无任何模糊或未定义的部分
✅ **可测试性**：提供完整的测试用例
✅ **可实现性**：所有要求都可用现有工具实现

**最终判定**：该需求文档可以直接交付给程序员实现，无需进一步澄清。
